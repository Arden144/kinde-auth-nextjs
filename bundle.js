"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e);const n={user:null,isAuthenticated:!1,isLoading:!0,checkSession:null},o=()=>{throw new Error("Oops! Seems like you forgot to wrap your app in <KindeProvider>.")},s=e.createContext({...n,user:o,isLoading:o,isAuthenticated:o,checkSession:o});const a=require("crypto"),i=()=>a.randomBytes(28).toString("hex");const{subtle:u}=require("crypto");async function c(e){const t=await function(e){const t=(new TextEncoder).encode(e);return u.digest("SHA-256",t)}(e);return r=t,btoa(String.fromCharCode.apply(null,new Uint8Array(r))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");var r}var l=require("cookie");const d=async()=>{const e=i(),t=i(),r=await c(t);l.parse(`pkce-verifier-${e}`,t);const n=new URL("https://developer.mozilla.org/oauth2/auth");return console.log(n),{state:e,code_challenge:r,url:n}};exports.AuthContext=s,exports.KindeProvider=({children:t,initialUser:o})=>{const[a,i]=e.useState({...n,user:o,isLoading:!o,isAuthenticated:!!o}),u="/api/auth/me",c=e.useCallback((async()=>{try{const e=await(async e=>{let t;try{t=await fetch(e)}catch{throw new RequestError(0)}if(t.ok)return t.json();t.status})(u);i((t=>({...t,user:e,error:void 0})))}catch(e){i((t=>({...t,error:e})))}}),[u]);e.useEffect((()=>{a.user||(async()=>{await c(),i((e=>({...e,isLoading:!1})))})()}),[a.user]);const{user:l,error:d,isLoading:h,isAuthenticated:p}=a;return r.default.createElement(s.Provider,{value:{user:l,error:d,isLoading:h,isAuthenticated:p}},t)},exports.handleAuth=()=>function(e,t){let{query:{kindeAuth:r}}=e;switch(r=Array.isArray(r)?r[0]:r,r){case"login":((e,t)=>{d(),t.status(200).json({function:"Login"})})(0,t);case"register":((e,t)=>{d(),t.status(200).json({function:"Register"})})(0,t);case"me":((e,t)=>{d(),t.status(200).json({function:"me"})})(0,t);case"logout":((e,t)=>{d(),t.status(200).json({function:"logout"})})(0,t);default:t.status(404).end()}},exports.useAuth=()=>e.useContext(s);
